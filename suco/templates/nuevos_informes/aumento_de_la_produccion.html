{% extends "basenueva_bootstrap.html" %}
{% load unslugify %}
{% load tools %}
{%block extra_header%}
<script>
$( document ).ready(function() {
    $('.format_diff').each(function() {
        var val = $(this).html();

        if (val[val.length -1] == "%") {
            val = val.replace('%', '');
        }

        if (val > 0) {
            $(this).addClass('green_cell');
        } else if (val < 0) {
            $(this).addClass('red_cell');
        }
    });
});
</script>
{%endblock%}
{% block content %}


    <form action="." method="POST" style="display:none">
        {% csrf_token %}
            <div class="form_widget">{{form.grupo}}<br>{{form.grupo.errors}}</div><br> <br>
            <div class="form_widget">{{form.centroregional}}<br>{{form.centroregional.errors}}</div><br> <br>
            <div class="form_widget">{{form.numero_encuesta}}<br>{{form.numero_encuesta.errors}}</div><br> <br>
            <div class="form_widget">{{form.indicador}}<br>{{form.indicador.errors}}</div><br><br>
            <div class="form_widget">Solo jovenes activados {{form.jovenes_activados_solo}}<br>{{form.jovenes_activados_solo.errors}}</div><br> <br>
            <input type="submit" value="" class="consultar"/>
    </form>


    <h1>{{ indicador_name }}</h1>
    <table class="table table-condensed table-bordered table-striped">
        <tr>
            <td style="width:65%">Grupo(s):</td>
            <td>{{ data.strings.grupos_name }}</td>
        </tr>
        <tr>
            <td>Centro(s) Regional(es):</td>
            <td>{{ data.strings.centroregional_name }}</td>
        </tr>
        <tr>
            <td>Numero de encuesta:</td>
            <td>{{ data.strings.numero_encuesta_name }}</td>
        </tr>
        <tr>
            <td>Numero total de jovenes utilizados en estos calculos</td>
            <td>
                {{ data.strings.numero_total_encuestas1 }}{% if numero_encuesta == "3" %} (primera encuesta)
                <br/>
                {{ data.strings.numero_total_encuestas2 }} (segunda encuesta)
                {% endif %}
            </td>
        </tr>
        <tr>
            <td>Numero total de encuestas utilizadas en estos calculos</td>
            <td>{{ data.strings.numero_total_jovenes1 }}{% if numero_encuesta == "3" %} (primera encuesta)
                <br/>
                {{ data.strings.numero_total_jovenes2 }} (segunda encuesta)
                {% endif %}

            </td>
        </tr>
        {% if numero_encuesta == "3" %}
        <tr>
            <td>Utilizar solo los datos de jóvenes que tienen dos encuestas rellenadas?</td>
            <td>{{ data.strings.solo_jovenes_con_dos_name }}</td>
        </tr>
        {% endif %}
        <tr>
            <td>Solo jóvenes activados?</td>
            <td>{{ data.strings.activo_name }}</td>
        </tr>
    </table>

    <h2>Datos</h2>


    <!-- Tab panes -->

        <a href="#" class="exportar guardarXLS" onclick="exportarXLS('finca'); return false;">Exportar en Excel</a>
        <div id="finca">
            <h3>Cultivos en la finca</h3>
            <div class="table-responsive">
                <table class="table table-striped table-bordered table-condensed">
                    <thead>
                        <tr>
                            <th>CULTIVOS</th>

                            <th class="last_datagroup_col">Unidad</th>

                            <th>Áreas{% if numero_encuesta == "3" %}<br/>Primera encuesta{% endif %}</th>
                            {% if numero_encuesta == "3" %}
                                <th>Áreas <br/>Segunda encuesta</th>
                                <th class="last_datagroup_col">Áreas <br/>Diferencia</th>
                            {% endif %}


                            <th>Total producción por año{% if numero_encuesta == "3" %}<br/>Primera encuesta{% endif %}</th>
                            {% if numero_encuesta == "3" %}
                                <th>Total producción por año <br/>Segunda encuesta<br/>(En su unidad.)</th>
                            {% endif %}

                            <th>Total producción por año{% if numero_encuesta == "3" %}<br/>Primera encuesta{% endif %}<br/>(Convertido en Kg)</th>
                            {% if numero_encuesta == "3" %}
                                <th>Total producción por año <br/>Segunda encuesta<br/>(Convertido en Kg)</th>
                                <th class="last_datagroup_col">Producción <br/>Diferencia</th>
                            {% endif %}


                            <th>Consumo por año{% if numero_encuesta == "3" %}<br/>Primera encuesta{% endif %}<br/>(En su unidad.)</th>
                            {% if numero_encuesta == "3" %}
                                <th>Consumo por año <br/>Segunda encuesta<br/>(En su unidad.)</th>
                            {% endif %}

                            <th>Consumo por año{% if numero_encuesta == "3" %}<br/>Primera encuesta{% endif %}<br/>(Convertido en Kg)</th>
                            {% if numero_encuesta == "3" %}
                                <th>Consumo por año <br/>Segunda encuesta<br/>(Convertido en Kg)</th>
                                <th class="last_datagroup_col">Consumo<br/>Diferencia</th>
                            {% endif %}



                            <th>Precio promedio de venta en mercado promedio{% if numero_encuesta == "3" %}<br/>Primera encuesta{% endif %}</th>
                            {% if numero_encuesta == "3" %}
                                <th>Precio promedio de venta en mercado promedio <br/>Segunda encuesta</th>
                                <th class="last_datagroup_col">Precio<br/>Diferencia</th>
                            {% endif %}

                            <th>Valor producida {% if numero_encuesta == "3" %}<br/>Primera encuesta{% endif %}</th>
                            {% if numero_encuesta == "3" %}
                                <th>Valor producida <br/>Segunda encuesta</th>
                                <th class="last_datagroup_col">Valor<br/>Diferencia</th>
                            {% endif %}



                        </tr>
                    </thead>
                    <tbody>
                        {%for key, value in data.tablas.tabla_cultivos.items%}
                        <tr>
                            <td>
                                {{key|unslugify}} ({{ value.id }})
                            </td>

                            <td class="last_datagroup_col">{{value.key2|unslugify}}</td>

                            <td>{{value.area1}}</td>
                            {% if numero_encuesta == "3" %}
                                <td>{{value.area2|floatformat:3}}</td>
                                <td class="last_datagroup_col format_diff">{{value.area_diff|percent}}</td>
                            {% endif %}


                            <td>{{value.totales1|floatformat:2}}</td>
                            {% if numero_encuesta == "3" %}
                                <td>{{value.totales2|floatformat:2}}</td>
                            {% endif %}


                            <td>{{value.totales1_kg|floatformat:2}}</td>
                            {% if numero_encuesta == "3" %}
                                <td>{{value.totales2_kg|floatformat:2}}</td>
                                <td class="last_datagroup_col format_diff">{{value.totales_diff|percent}}</td>
                            {% endif %}



                            <td>{{value.consumo1|floatformat:2}}</td>
                            {% if numero_encuesta == "3" %}
                                <td>{{value.consumo2|floatformat:2}}</td>
                            {% endif %}

                            <td>{{value.consumo1_kg|floatformat:2}}</td>
                            {% if numero_encuesta == "3" %}
                                <td>{{value.consumo2_kg|floatformat:2}}</td>
                                <td class="last_datagroup_col format_diff">{{value.consumo_diff|percent}}</td>
                            {% endif %}


                            <td>{{value.precio1|floatformat:2}}</td>
                            {% if numero_encuesta == "3" %}
                                <td>
                                    {{value.precio2|floatformat:2}}
                                </td>
                                <td class="last_datagroup_col format_diff">{{value.precio_diff|percent}}</td>
                            {% endif %}


                            <td>{{value.valor1|floatformat:2}}</td>
                            {% if numero_encuesta == "3" %}
                                <td>{{value.valor2|floatformat:2}}</td>
                                <td class="format_diff">{{value.valor_diff|percent}}</td>
                            {% endif %}

                        </tr>
                        {%endfor%}
                    <tbody>
                </table>
            </div>
        </div>




        <a href="#" class="exportar guardarXLS" onclick="exportarXLS('animales'); return false;">Exportar en Excel</a>
        <div id="animales">
            <h3>Animales</h3>
            <table  class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th>Animales</th>
                        <th>Cantidad de personas que tienen animales</th>
                        <th>% de personas que tienen animales</th>
                    </tr>
                </thead>
                <tbody>
                    {%for fila in data.encuestas.0.tabla_animales%}
                    <tr>
                        {%for celda in fila%}
                        <td>{{celda}}</td>
                        {%endfor%}
                    </tr>
                    {%endfor%}
                </tbody>
            </table>
        </div>


{% endblock %}
